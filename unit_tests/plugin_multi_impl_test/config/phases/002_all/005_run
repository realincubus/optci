#!/bin/bash
OPTCI_PREPARE

EXTRA_ARGS=""
if [[ $EMIT_TYPE == "-emit-hpx" ]]; then
  THREADS_TO_RUN=$(echo " $SOCKETS * $CORES_PER_SOCKET * $THREADS_PER_CORE" | bc )
  EXTRA_ARGS="--hpx:threads=$THREADS_TO_RUN"
fi
echo "EXTRA ARGS: $EXTRA_ARGS"
time="$(OPTCI_PIN_RUN ./bin_matrix_multiply_example $SIZE $ITERATIONS $EXTRA_ARGS)"

bin_rana -a << EOF | tee -a $RESULTS_OUT
SOCKETS=$SOCKETS
CORES_PER_SOCKET=$CORES_PER_SOCKET
THREADS_PER_CORE=$THREADS_PER_CORE
TYPE=$EMIT_TYPE
TIME=$time
EOF

OPTCI_CLEANUP
